<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PreShop</title>
  <style>
    body { margin:0; padding:0; background:#000; color:#fff; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; }
    header { padding:1rem; text-align:center; background:#111; border-bottom:1px solid #333; }
    h1 { margin:0; font-size:1.5rem; }
    .container { padding:1rem; max-width:600px; margin:auto; }
    input, button { margin:0.3rem 0; padding:0.5rem; border-radius:5px; border:none; font-size:1rem; }
    input { width:100%; background:#222; color:#fff; }
    button { background:#444; color:#fff; cursor:pointer; }
    button:hover { background:#666; }
    ul { list-style:none; padding:0; }
    li { background:#111; margin:0.5rem 0; padding:0.5rem; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
    .done { text-decoration:line-through; color:#888; }
    .price { font-weight:bold; color:#0f0; }
    .total { margin-top:1rem; padding:0.7rem; background:#111; border-radius:5px; font-size:1.2rem; text-align:right; }
    .auth { text-align:center; margin:1rem; }
  </style>
  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // TODO: ğŸ”‘ ì—¬ê¸°ì— ë„¤ Firebase ì„¤ì • ë¶™ì—¬ë„£ê¸°
const firebaseConfig = {
Â  apiKey: "AIzaSyBwTEWTTL25tj5oyIKtPdbFXnodoSEFH6s",
Â  authDomain: "preshop-36d77.firebaseapp.com",
Â  projectId: "preshop-36d77",
Â  storageBucket: "preshop-36d77.firebasestorage.app",
Â  messagingSenderId: "588673363293",
Â  appId: "1:588673363293:web:f35e1e039a569cdca74cb4",
Â  measurementId: "G-LWQDM6ZM80"
};

    // Firebase ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;

    // ë¡œê·¸ì¸ & ë¡œê·¸ì•„ì›ƒ
    async function login() {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    }

    async function logout() {
      await signOut(auth);
    }

    // ë¡œê·¸ì¸ ìƒíƒœ ë³€í™” ê°ì§€
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      if (user) {
        document.getElementById("authStatus").textContent = `ğŸ‘¤ ${user.displayName}`;
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
        loadItems();
      } else {
        document.getElementById("authStatus").textContent = "ë¡œê·¸ì¸ í•„ìš”";
        document.getElementById("loginBtn").style.display = "inline-block";
        document.getElementById("logoutBtn").style.display = "none";
        document.getElementById("list").innerHTML = "";
        updateTotal(0);
      }
    });

    // ì•„ì´í…œ ì¶”ê°€
    async function addItem() {
      if (!currentUser) return alert("ë¡œê·¸ì¸ ë¨¼ì € í•´ì£¼ì„¸ìš”!");

      const itemName = document.getElementById("itemInput").value.trim();
      const itemPrice = parseInt(document.getElementById("priceInput").value) || 0;
      const itemUrl = document.getElementById("urlInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim() || "ê¸°íƒ€";

      if (!itemName) return alert("ìƒí’ˆ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”!");

      await addDoc(collection(db, "items"), {
        uid: currentUser.uid,
        name: itemName,
        price: itemPrice,
        url: itemUrl,
        category: category,
        createdAt: Date.now()
      });

      document.getElementById("itemInput").value = "";
      document.getElementById("priceInput").value = "";
      document.getElementById("urlInput").value = "";
      document.getElementById("categoryInput").value = "";
    }

    // ì•„ì´í…œ ë¶ˆëŸ¬ì˜¤ê¸°
    function loadItems() {
      const list = document.getElementById("list");
      const q = query(collection(db, "items"), where("uid", "==", currentUser.uid));

      onSnapshot(q, (snapshot) => {
        list.innerHTML = "";
        let total = 0;

        snapshot.forEach((docSnap) => {
          const item = docSnap.data();
          total += item.price;

          const li = document.createElement("li");
          li.innerHTML = `
            <div>
              <span><strong>[${item.category}]</strong> ${item.name}</span><br>
              ${item.price ? `<span class="price">${item.price.toLocaleString()}ì›</span>` : ""}
              ${item.url ? `<a href="${item.url}" target="_blank" style="color:#0af;">ğŸ”— ë§í¬</a>` : ""}
            </div>
            <div>
              <button onclick="removeItem('${docSnap.id}', ${item.price})">ì‚­ì œ</button>
            </div>
          `;
          list.appendChild(li);
        });

        updateTotal(total);
      });
    }

    // ì•„ì´í…œ ì‚­ì œ
    async function removeItem(id, price) {
      await deleteDoc(doc(db, "items", id));
    }

    // ì´í•© ì—…ë°ì´íŠ¸
    function updateTotal(total) {
      document.getElementById("totalPrice").textContent = total.toLocaleString();
    }

    // ì „ì—­ì— í•¨ìˆ˜ ë“±ë¡ (HTMLì—ì„œ í˜¸ì¶œí•˜ë ¤ë©´ í•„ìš”)
    window.addItem = addItem;
    window.login = login;
    window.logout = logout;
    window.removeItem = removeItem;
  </script>
</head>
<body>
  <header>
    <h1>ğŸ›’ PreShop</h1>
    <div class="auth">
      <span id="authStatus">ë¡œê·¸ì¸ í•„ìš”</span><br>
      <button id="loginBtn" onclick="login()">Google ë¡œê·¸ì¸</button>
      <button id="logoutBtn" onclick="logout()" style="display:none;">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
  </header>
  <div class="container">
    <input type="text" id="itemInput" placeholder="ìƒí’ˆ ì´ë¦„ ì…ë ¥">
    <input type="number" id="priceInput" placeholder="ê°€ê²© ì…ë ¥ (ìˆ«ì)">
    <input type="text" id="urlInput" placeholder="ìƒí’ˆ URL (ì„ íƒ)">
    <input type="text" id="categoryInput" placeholder="ì¹´í…Œê³ ë¦¬ (ì˜ˆ: ì˜·, ì¡í™”)">
    <button onclick="addItem()">+ ìƒí’ˆ ì¶”ê°€</button>

    <ul id="list"></ul>
    <div class="total">ì´í•©: <span id="totalPrice">0</span> ì›</div>
  </div>
</body>
</html>