<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>PreShop</title>
  <style>
    body { margin:0; padding:0; background:#000; color:#fff; font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,sans-serif; }
    header { padding:1rem; text-align:center; background:#111; border-bottom:1px solid #333; }
    h1 { margin:0; font-size:1.5rem; }
    .container { padding:1rem; max-width:600px; margin:auto; }
    input, button { margin:0.3rem 0; padding:0.5rem; border-radius:5px; border:none; font-size:1rem; }
    input { width:100%; background:#222; color:#fff; }
    button { background:#444; color:#fff; cursor:pointer; }
    button:hover { background:#666; }
    ul { list-style:none; padding:0; }
    li { background:#111; margin:0.5rem 0; padding:0.5rem; border-radius:5px; display:flex; justify-content:space-between; align-items:center; }
    .done { text-decoration:line-through; color:#888; }
    .price { font-weight:bold; color:#0f0; }
    .total { margin-top:1rem; padding:0.7rem; background:#111; border-radius:5px; font-size:1.2rem; text-align:right; }
    .auth { text-align:center; margin:1rem; }
  </style>
  <!-- Firebase SDK -->
  <script type="module">
    // Import Firebase SDKs
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, where, onSnapshot } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // TODO: 🔑 여기에 네 Firebase 설정 붙여넣기
const firebaseConfig = {
  apiKey: "AIzaSyBwTEWTTL25tj5oyIKtPdbFXnodoSEFH6s",
  authDomain: "preshop-36d77.firebaseapp.com",
  projectId: "preshop-36d77",
  storageBucket: "preshop-36d77.firebasestorage.app",
  messagingSenderId: "588673363293",
  appId: "1:588673363293:web:f35e1e039a569cdca74cb4",
  measurementId: "G-LWQDM6ZM80"
};

    // Firebase 초기화
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let currentUser = null;

    // 로그인 & 로그아웃
    async function login() {
      const provider = new GoogleAuthProvider();
      await signInWithPopup(auth, provider);
    }

    async function logout() {
      await signOut(auth);
    }

    // 로그인 상태 변화 감지
    onAuthStateChanged(auth, (user) => {
      currentUser = user;
      if (user) {
        document.getElementById("authStatus").textContent = `👤 ${user.displayName}`;
        document.getElementById("loginBtn").style.display = "none";
        document.getElementById("logoutBtn").style.display = "inline-block";
        loadItems();
      } else {
        document.getElementById("authStatus").textContent = "로그인 필요";
        document.getElementById("loginBtn").style.display = "inline-block";
        document.getElementById("logoutBtn").style.display = "none";
        document.getElementById("list").innerHTML = "";
        updateTotal(0);
      }
    });

    // 아이템 추가
    async function addItem() {
      if (!currentUser) return alert("로그인 먼저 해주세요!");

      const itemName = document.getElementById("itemInput").value.trim();
      const itemPrice = parseInt(document.getElementById("priceInput").value) || 0;
      const itemUrl = document.getElementById("urlInput").value.trim();
      const category = document.getElementById("categoryInput").value.trim() || "기타";

      if (!itemName) return alert("상품 이름을 입력하세요!");

      await addDoc(collection(db, "items"), {
        uid: currentUser.uid,
        name: itemName,
        price: itemPrice,
        url: itemUrl,
        category: category,
        createdAt: Date.now()
      });

      document.getElementById("itemInput").value = "";
      document.getElementById("priceInput").value = "";
      document.getElementById("urlInput").value = "";
      document.getElementById("categoryInput").value = "";
    }

    // 아이템 불러오기
    function loadItems() {
      const list = document.getElementById("list");
      const q = query(collection(db, "items"), where("uid", "==", currentUser.uid));

      onSnapshot(q, (snapshot) => {
        list.innerHTML = "";
        let total = 0;

        snapshot.forEach((docSnap) => {
          const item = docSnap.data();
          total += item.price;

          const li = document.createElement("li");
          li.innerHTML = `
            <div>
              <span><strong>[${item.category}]</strong> ${item.name}</span><br>
              ${item.price ? `<span class="price">${item.price.toLocaleString()}원</span>` : ""}
              ${item.url ? `<a href="${item.url}" target="_blank" style="color:#0af;">🔗 링크</a>` : ""}
            </div>
            <div>
              <button onclick="removeItem('${docSnap.id}', ${item.price})">삭제</button>
            </div>
          `;
          list.appendChild(li);
        });

        updateTotal(total);
      });
    }

    // 아이템 삭제
    async function removeItem(id, price) {
      await deleteDoc(doc(db, "items", id));
    }

    // 총합 업데이트
    function updateTotal(total) {
      document.getElementById("totalPrice").textContent = total.toLocaleString();
    }

    // 전역에 함수 등록 (HTML에서 호출하려면 필요)
    window.addItem = addItem;
    window.login = login;
    window.logout = logout;
    window.removeItem = removeItem;
  </script>
</head>
<body>
  <header>
    <h1>🛒 PreShop</h1>
    <div class="auth">
      <span id="authStatus">로그인 필요</span><br>
      <button id="loginBtn" onclick="login()">Google 로그인</button>
      <button id="logoutBtn" onclick="logout()" style="display:none;">로그아웃</button>
    </div>
  </header>
  <div class="container">
    <input type="text" id="itemInput" placeholder="상품 이름 입력">
    <input type="number" id="priceInput" placeholder="가격 입력 (숫자)">
    <input type="text" id="urlInput" placeholder="상품 URL (선택)">
    <input type="text" id="categoryInput" placeholder="카테고리 (예: 옷, 잡화)">
    <button onclick="addItem()">+ 상품 추가</button>

    <ul id="list"></ul>
    <div class="total">총합: <span id="totalPrice">0</span> 원</div>
  </div>
</body>
</html>